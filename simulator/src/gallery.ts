import * as t from "io-ts"
import { DisplayDef } from "./components/Display"
import { GateDef } from "./components/Gate"
import { LogicInputDef } from "./components/LogicInput"
import { LogicOutputDef } from "./components/LogicOutput"
import { WireRepr } from "./components/Wire"
import { PartialWhereUndefinedRecursively } from "./utils"

const Circuit = t.partial({
    in: t.array(LogicInputDef.repr),
    out: t.array(LogicOutputDef.repr),
    displays: t.array(DisplayDef),
    gates: t.array(GateDef),
    wires: t.array(WireRepr),
})
type Circuit = PartialWhereUndefinedRecursively<t.TypeOf<typeof Circuit>>

function assertCircuits<T extends Record<string, Circuit>>(v: T): T {
    // remove prototype to have a nice, clean completion in the console
    return Object.assign(Object.create(null), v)
}

export const gallery = assertCircuits({
    CharacterComparator: {
        "in": [
            { "pos": [50, 130], "id": 0, "val": 1 },
            { "pos": [50, 160], "id": 1, "val": 1 },
            { "pos": [50, 190], "id": 2, "val": 1 },
            { "pos": [50, 220], "id": 3, "val": 0 },
            { "pos": [50, 250], "id": 4, "val": 1 },
            { "pos": [50, 280], "id": 13, "val": 0 },
            { "pos": [50, 310], "id": 14, "val": 1 },
            { "pos": [50, 360], "id": 15, "val": 1 },
            { "pos": [50, 390], "id": 16, "val": 0 },
            { "pos": [50, 420], "id": 17, "val": 1 },
            { "pos": [50, 450], "id": 18, "val": 0 },
            { "pos": [50, 480], "id": 19, "val": 1 },
            { "pos": [50, 510], "id": 20, "val": 0 },
            { "pos": [50, 540], "id": 21, "val": 1 },
        ],
        "out": [{ "pos": [870, 310], "id": 5 }],
        "displays": [
            { "type": "ascii", "pos": [180, 60], "id": [6, 7, 8, 9, 10, 11, 12] },
            { "type": "ascii", "pos": [180, 620], "id": [22, 23, 24, 25, 26, 27, 28] },
        ],
        "gates": [
            { "type": "XOR", "pos": [360, 140], "in": [29, 30], "out": 31 },
            { "type": "XOR", "pos": [360, 200], "in": [32, 33], "out": 34 },
            { "type": "XOR", "pos": [360, 260], "in": [35, 36], "out": 37 },
            { "type": "XOR", "pos": [360, 320], "in": [38, 39], "out": 40 },
            { "type": "XOR", "pos": [360, 380], "in": [41, 42], "out": 43 },
            { "type": "XOR", "pos": [360, 440], "in": [44, 45], "out": 46 },
            { "type": "XOR", "pos": [360, 500], "in": [47, 48], "out": 49 },
            { "type": "OR", "pos": [470, 170], "in": [68, 69], "out": 70 },
            { "type": "OR", "pos": [500, 280], "in": [71, 72], "out": 73 },
            { "type": "OR", "pos": [490, 410], "in": [74, 75], "out": 76 },
            { "type": "OR", "pos": [630, 250], "in": [77, 78], "out": 79 },
            { "type": "OR", "pos": [630, 410], "in": [80, 81], "out": 82 },
            { "type": "OR", "pos": [730, 310], "in": [83, 84], "out": 85 },
            { "type": "NOT", "pos": [800, 310], "in": 50, "out": 51 },
        ],
        "wires": [
            [0, 6],
            [1, 7],
            [2, 8],
            [3, 9],
            [4, 10],
            [13, 11],
            [14, 12],
            [15, 22],
            [16, 23],
            [17, 24],
            [18, 25],
            [19, 26],
            [20, 27],
            [21, 28],
            [0, 29],
            [15, 30],
            [79, 83],
            [82, 84],
            [31, 68],
            [34, 69],
            [37, 71],
            [40, 72],
            [43, 74],
            [46, 75],
            [49, 81],
            [76, 80],
            [73, 78],
            [70, 77],
            [85, 50],
            [51, 5],
            [1, 32],
            [16, 33],
            [2, 35],
            [17, 36],
            [18, 39],
            [3, 38],
            [4, 41],
            [19, 42],
            [13, 44],
            [20, 45],
            [21, 48],
            [14, 47],
        ],
    },
    Counters: {
        "displays": [
            { "type": "nibble", "pos": [240, 90], "id": [1, 2, 3, 4] },
            { "type": "ascii", "pos": [580, 150], "id": [13, 14, 15, 16, 17, 18, 19] },
        ],
        "clocks": [
            { "pos": [70, 40], "id": 0, "name": "bit 0", "period": 2000, "phase": 1000, "showLabel": false },
            { "pos": [70, 80], "id": 10, "name": "bit 1", "period": 4000, "phase": 2000, "showLabel": false },
            { "pos": [70, 120], "id": 23, "name": "bit 2", "period": 8000, "phase": 4000, "showLabel": false },
            { "pos": [70, 160], "id": 24, "name": "bit 3", "period": 16000, "phase": 8000, "showLabel": false },
            { "pos": [430, 30], "id": 5, "period": 500, "phase": 250, "showLabel": false },
            { "pos": [430, 70], "id": 6, "period": 1000, "phase": 500, "showLabel": false },
            { "pos": [430, 110], "id": 7, "period": 2000, "phase": 1000, "showLabel": false },
            { "pos": [430, 150], "id": 8, "period": 4000, "phase": 2000, "showLabel": false },
            { "pos": [430, 190], "id": 9, "period": 8000, "phase": 4000, "showLabel": false },
            { "pos": [430, 230], "id": 11, "period": 16000, "phase": 8000, "showLabel": false },
            { "pos": [430, 270], "id": 12, "period": 32000, "phase": 16000, "showLabel": false },
        ],
        "wires": [
            [0, 1], [24, 4], [23, 3], [10, 2], [5, 13],
            [6, 14], [7, 15], [8, 16], [9, 17], [11, 18], [12, 19],
        ],
    },
    AllGates: {
        "in": [
            { "pos": [40, 320], "id": 0, "val": 0 },
            { "pos": [40, 490], "id": 1, "val": 0 },
        ],
        "out": [
            { "pos": [400, 30], "id": 48 },
            { "pos": [400, 80], "id": 49 },
            { "pos": [400, 140], "id": 50 },
            { "pos": [400, 260], "id": 51 },
            { "pos": [400, 380], "id": 52 },
            { "pos": [400, 200], "id": 53 },
            { "pos": [400, 320], "id": 54 },
            { "pos": [400, 440], "id": 55 },
            { "pos": [400, 560], "id": 56 },
            { "pos": [400, 680], "id": 57 },
            { "pos": [400, 500], "id": 58 },
            { "pos": [400, 620], "id": 59 },
            { "pos": [400, 740], "id": 60 },
            { "pos": [400, 860], "id": 61 },
            { "pos": [400, 800], "id": 62 },
            { "pos": [400, 920], "id": 63 },
        ],
        "gates": [
            { "type": "NOT", "pos": [290, 80], "in": 2, "out": 3 },
            { "type": "BUF", "pos": [290, 30], "in": 4, "out": 5 },
            { "type": "AND", "pos": [290, 140], "in": [6, 7], "out": 8 },
            { "type": "OR", "pos": [290, 260], "in": [9, 10], "out": 11 },
            { "type": "XOR", "pos": [290, 380], "in": [12, 13], "out": 14 },
            { "type": "NAND", "pos": [290, 200], "in": [15, 16], "out": 17 },
            { "type": "NOR", "pos": [290, 320], "in": [18, 19], "out": 20 },
            { "type": "XNOR", "pos": [290, 440], "in": [21, 22], "out": 23 },
            { "type": "IMPLY", "pos": [290, 560], "in": [24, 25], "out": 26 },
            { "type": "RIMPLY", "pos": [290, 680], "in": [27, 28], "out": 29 },
            { "type": "NIMPLY", "pos": [290, 500], "in": [30, 31], "out": 32 },
            { "type": "RNIMPLY", "pos": [290, 620], "in": [33, 34], "out": 35 },
            { "type": "TXA", "pos": [290, 740], "in": [36, 37], "out": 38 },
            { "type": "TXB", "pos": [290, 860], "in": [39, 40], "out": 41 },
            { "type": "TXNA", "pos": [290, 800], "in": [42, 43], "out": 44 },
            { "type": "TXNB", "pos": [290, 920], "in": [45, 46], "out": 47 },
        ],
        "wires": [
            [0, 4],
            [0, 2],
            [0, 6],
            [0, 9],
            [0, 12],
            [0, 15],
            [0, 18],
            [0, 21],
            [0, 24],
            [0, 27],
            [0, 30],
            [0, 33],
            [0, 36],
            [0, 39],
            [0, 42],
            [0, 45],
            [1, 7],
            [1, 10],
            [1, 13],
            [1, 16],
            [1, 19],
            [1, 22],
            [1, 25],
            [1, 28],
            [1, 31],
            [1, 34],
            [1, 37],
            [1, 40],
            [1, 43],
            [1, 46],
            [5, 48],
            [3, 49],
            [8, 50],
            [11, 51],
            [14, 52],
            [17, 53],
            [20, 54],
            [23, 55],
            [26, 56],
            [29, 57],
            [32, 58],
            [35, 59],
            [38, 60],
            [41, 61],
            [44, 62],
            [47, 63],
        ],
    },
    SevenSegmentDisplay: {
        "displays": [
            { "type": "nibble", "pos": [1320, 140], "id": [132, 133, 134, 135], "radix": 16 },
            { "type": "bar", "pos": [1330, 310], "id": 117, "display": "h" },
            { "type": "bar", "pos": [1270, 490], "id": 118, "display": "v" },
            { "type": "bar", "pos": [1390, 370], "id": 119, "display": "v" },
            { "type": "bar", "pos": [1270, 370], "id": 120, "display": "v" },
            { "type": "bar", "pos": [1330, 430], "id": 121, "display": "h" },
            { "type": "bar", "pos": [1390, 490], "id": 122, "display": "v" },
            { "type": "bar", "pos": [1330, 550], "id": 123, "display": "h" },
        ],
        "clocks": [
            { "pos": [90, 60], "orient": "s", "id": 21, "period": 16000, "phase": 8000 },
            { "pos": [130, 60], "orient": "s", "id": 22, "period": 8000, "phase": 4000 },
            { "pos": [170, 60], "orient": "s", "id": 23, "period": 4000, "phase": 2000 },
            { "pos": [210, 60], "orient": "s", "id": 24, "period": 2000, "phase": 1000 },
        ],
        "gates": [
            { "type": "NOT", "pos": [1170, 310], "in": 103, "out": 104 },
            { "type": "NOT", "pos": [1170, 350], "in": 105, "out": 106 },
            { "type": "NOT", "pos": [1170, 390], "in": 107, "out": 108 },
            { "type": "NOT", "pos": [1170, 430], "in": 109, "out": 110 },
            { "type": "NOT", "pos": [1170, 550], "in": 111, "out": 112 },
            { "type": "NOT", "pos": [1170, 510], "in": 113, "out": 114 },
            { "type": "NOT", "pos": [1170, 470], "in": 115, "out": 116 },
            { "type": "XOR", "pos": [210, 180], "in": [0, 1], "out": 2 },
            { "type": "AND", "pos": [220, 340], "in": [3, 4], "out": 5 },
            { "type": "XOR", "pos": [200, 420], "in": [6, 7], "out": 8 },
            { "type": "XOR", "pos": [330, 220], "in": [9, 10], "out": 11 },
            { "type": "XOR", "pos": [340, 280], "in": [12, 13], "out": 14 },
            { "type": "OR", "pos": [320, 480], "in": [15, 16], "out": 17 },
            { "type": "NOR", "pos": [440, 220], "in": [18, 19], "out": 20 },
            { "type": "XOR", "pos": [450, 290], "in": [25, 26], "out": 27 },
            { "type": "NOR", "pos": [430, 450], "in": [31, 32], "out": 33 },
            { "type": "NOR", "pos": [560, 410], "in": [34, 35], "out": 36 },
            { "type": "NOR", "pos": [600, 190], "in": [37, 38], "out": 39 },
            { "type": "NOR", "pos": [540, 360], "in": [40, 41], "out": 42 },
            { "type": "XOR", "pos": [650, 320], "in": [43, 44], "out": 45 },
            { "type": "OR", "pos": [670, 430], "in": [46, 47], "out": 48 },
            { "type": "XOR", "pos": [770, 490], "in": [49, 50], "out": 51 },
            { "type": "NOR", "pos": [770, 540], "in": [52, 53], "out": 54 },
            { "type": "NOR", "pos": [800, 390], "in": [55, 56], "out": 57 },
            { "type": "OR", "pos": [960, 250], "in": [58, 59], "out": 60 },
            { "type": "NOR", "pos": [940, 310], "in": [61, 62], "out": 63 },
            { "type": "AND", "pos": [1050, 270], "in": [64, 65], "out": 66 },
            { "type": "AND", "pos": [950, 380], "in": [67, 68], "out": 69 },
            { "type": "AND", "pos": [950, 440], "in": [70, 71], "out": 72 },
            { "type": "OR", "pos": [1030, 410], "in": [73, 74], "out": 75 },
            { "type": "XOR", "pos": [1030, 520], "in": [76, 77], "out": 78 },
        ],
        "wires": [
            [104, 117],
            [106, 119],
            [108, 122],
            [110, 123],
            [112, 121],
            [114, 120],
            [116, 118],
            [21, 135],
            [22, 134],
            [23, 133],
            [24, 132],
            [21, 0],
            [23, 1],
            [24, 3],
            [22, 4],
            [24, 6],
            [21, 7],
            [2, 9],
            [22, 10],
            [23, 12],
            [5, 13],
            [5, 15],
            [8, 16],
            [11, 18],
            [14, 19],
            [11, 25],
            [8, 26],
            [5, 32],
            [14, 31],
            [33, 34],
            [21, 35],
            [20, 37],
            [2, 38],
            [27, 40],
            [8, 41],
            [42, 43],
            [21, 44],
            [39, 46],
            [17, 47],
            [48, 49],
            [21, 50],
            [48, 52],
            [33, 53],
            [36, 56],
            [45, 55],
            [57, 103],
            [39, 58],
            [24, 59],
            [60, 64],
            [27, 65],
            [66, 109],
            [39, 61],
            [45, 62],
            [63, 113],
            [69, 73],
            [72, 74],
            [75, 105],
            [39, 67],
            [24, 68],
            [45, 70],
            [22, 71],
            [51, 115],
            [20, 111],
            [78, 107],
            [72, 76],
            [54, 77],
        ],
    },
})